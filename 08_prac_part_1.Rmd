---
title: "R and spatial data: intermediate 1"
author: "Radoslaw Panczak"
date: 2019-02-26
output: 
  html_document: 
    # css: custom.css
    toc: true
    toc_depth: 4
    toc_float: true
    number_sections: true
    theme: united 
    highlight: pygments 
---

# Maintenance 

## Start R session and Rstudio

You might want to continue using project from yesterday.

## Load the libraries

```{r}
set.seed(1234)

if (!require("tidyverse")) install.packages("tidyverse"); library("tidyverse")
if (!require("sf")) install.packages("sf"); library("sf")
if (!require("tmap")) install.packages("tmap"); library("tmap")
if (!require("sjmisc")) install.packages("sjmisc"); library("sjmisc")

if (!require("skimr")) install.packages("skimr"); library("skimr")

```

# Data sources

## SA2s and SEIFA

We will reuse data prepared yesterday.

### Code

```{r}
SA2_SEIFA <- readRDS("data/clean/SA2_SEIFA.Rds")
```


# Airbnb in Melbourne

## Background information

[Inside Airbnb](http://insideairbnb.com/about.html) is website that describes itself as:

> an independent, non-commercial set of tools and data that allows you to explore how Airbnb is really being used in cities around the world. By analyzing publicly available information about a city's Airbnb's listings, Inside Airbnb provides filters and key metrics so you can see how Airbnb is being used to compete with the residential housing market.

The dataset is not offically approved by Airbnb (!) but is released under open license and in the absence of other data - was used by many research projects around the world.

## Reading the data

### Code 

```{r}
listings <- read_csv("./data/clean/listings.csv")
```

### Explanation

## Examine the data

### Code 

```{r}
slice(listings, 1:5)
```

```{r, results='asis' }
skim(listings) %>% skimr::kable()
```

### Explanation

## Turning data spatial

### Code 

```{r}
listings_sf = st_as_sf(listings, coords = c("longitude", "latitude"), crs = 4326)
```

### Explanation

Look at the difference

```{r}
slice(listings_sf, 1:5)
```

http://spatialreference.org/ref/epsg/wgs-84/ 

## Your first map

```{r}
tmap_mode("view")
qtm(listings_sf)
```

## Improving your map

Map variable in your data to visual encoding on map.

```{r}
ggplot(listings_sf, aes(price)) + geom_histogram()
```

```{r}
summary(listings_sf$price)
```

```{r}
listings_sf %>% 
  sample_n(1000) %>%
  tm_shape() + 
  tm_dots(col = "price", style = "quantile", n = 10, palette = "RdYlGn")
```

`tmaptools::palette_explorer()`


## Static map

```{r}
tmap_mode("plot")
qtm(listings_sf)
```

## Improving your map

```{r}
listings_sf %>% 
  # sample_n(1000) %>%
  tm_shape() + 
  tm_dots(col = "price", title = "Price of listing",
          style = "quantile", n = 10, 
          palette = "RdYlGn", legend.hist = T) +  
  tm_scale_bar(position = c("left", "bottom")) +
  tm_compass(position = c("left", "top"))+
  tm_layout(frame = F, 
            main.title = "Price of Airbnb listing in Melbourne",
            main.title.size = 1.25, 
            main.title.position = c("left", "top"),
            legend.hist.size = 0.5, 
            legend.outside = T)
```

```{r}
listings_sf %>% 
  ggplot(aes(room_type)) + geom_bar()
```

```{r}
listings_sf %>% 
  ggplot(aes(room_type, price)) + geom_boxplot() + scale_y_log10()
```

```{r}
listings_sf %>% 
  filter(room_type != "Shared room") %>% 
  # sample_n(1000) %>%
  tm_shape() + 
  tm_dots(col = "price", title = "Price of listing",
          style = "quantile", n = 10, 
          palette = "RdYlGn", legend.hist = T) +  
  tm_scale_bar(position = c("left", "bottom")) +
  tm_compass(position = c("left", "top"))+
  tm_layout(frame = F, 
            main.title = "Price of Airbnb listing in Melbourne",
            main.title.size = 1.25, 
            main.title.position = c("left", "top"),
            legend.hist.size = 0.5, 
            legend.outside = T) +
  tm_facets(by = "room_type")

```


# Resources




