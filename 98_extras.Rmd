# Class intervals

# Hexbins
```{r}
knitr::opts_chunk$set(echo = FALSE)

library(spData)
library(classInt)

data(jenks71, package="spData")
pal1 <- c("wheat1", "red3")
opar <- par(mfrow=c(2,3))
plot(classIntervals(jenks71$jenks71, n=5, style="fixed",
 fixedBreaks=c(15.57, 25, 50, 75, 100, 155.30)), pal=pal1, main="Fixed")
plot(classIntervals(jenks71$jenks71, n=5, style="sd"), pal=pal1, main="Pretty standard deviations")
plot(classIntervals(jenks71$jenks71, n=5, style="equal"), pal=pal1, main="Equal intervals")
plot(classIntervals(jenks71$jenks71, n=5, style="quantile"), pal=pal1, main="Quantile")
set.seed(1)
plot(classIntervals(jenks71$jenks71, n=5, style="kmeans"), pal=pal1, main="K-means")
plot(classIntervals(jenks71$jenks71, n=5, style="hclust", method="complete"),
 pal=pal1, main="Complete cluster")

```

```{r}
grid_hex <- listings_sf_proj %>% 
  filter(room_type == "Private room") %>% 
  st_bbox() %>% 
  st_as_sfc() %>% 
  st_make_grid(n = 50, square = FALSE) %>% 
  st_sf() %>% 
  mutate(ID = row_number())

qtm(grid_hex)
```

Link points to polygons aka spatial join

```{r}
grid_count <- st_join(filter(listings_sf_proj, room_type == "Private room"),
                      grid_hex, join = st_intersects) %>% 
  st_drop_geometry() %>% 
  group_by(ID) %>% 
  summarise(room_count = n())


grid_hex_count <- left_join(grid_hex, grid_count, by = c("ID", "ID"))

tm_shape(grid_hex_count) +
  tm_polygons(col = "room_count", 
              n = 5, alpha = 0.8, palette = "-RdYlGn", lwd = 0) 

```

# Correlogram 

```{r}
SA2_IRSAD_s_corr <- sp.correlogram(neighbours = SA2_weights_queen, var = SA2_SEIFA_proj$IRSAD_s,
                                   order = 10, method = "I", style = "C")


library(pgirmess)
SA2_IRSAD_s_corr <- correlog(coordinates(SA2_SEIFA_proj), SA2_SEIFA_proj$IRSAD_s, method = "Moran")
```

# Lisa on point data


```{r}
if (!require("ncf")) install.packages("ncf"); library("ncf")

listings <- read_csv("./data/listings.csv") %>% 
  filter(room_type == "Private room") # %>% sample_n(500)

listings_lisa <- lisa(listings$latitude, listings$longitude, listings$price, 
                      neigh = 10, resamp = 1000, latlon = TRUE, quiet = FALSE)

plot(listings_lisa)

```
